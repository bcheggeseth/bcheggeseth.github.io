{
  "hash": "83d1c2c1d34ed46bbc759060a7fdaf47",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"LEGO Sets\"\ndate: \"2022-09-06\"\nimage: tt20220906.jpeg\nabout: \n  template: solana\n  image: tt20220906.jpeg\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get the Data\nlibrary(readr) #install.packages('readr') in Console first\nlibrary(dplyr) #install.packages('dplyr') in Console first\n\ninventories <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-06/inventories.csv.gz')\ninventory_sets <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-06/inventory_sets.csv.gz')\nsets <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-06/sets.csv.gz')\n```\n:::\n\n\n\n\n## Data Context\n\n### LEGO sets\n\nThe data this week comes from rebrickable courtesy of Georgios Karamanis.\n\nThe LEGO Parts/Sets/Colors and Inventories of every official LEGO set in the Rebrickable database is available for download as csv files here. These files are automatically updated daily. If you need more details, you can use the API which provides real-time data, but has rate limits that prevent bulk downloading of data.\n\nIf you'd like to get more data, go to https://rebrickable.com/downloads/ and download any X.csv.gz files.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# I downloaded themes, colors and inventory_parts from the site above.\nthemes <- readr::read_csv('themes.csv.gz') %>% rename(theme_name = name,theme_id = id)\ncolors_df <- readr::read_csv('colors.csv.gz') %>% rename(color_name = name, color_id = id)\ninventory_parts <- readr::read_csv('inventory_parts.csv.gz') \n\n\nall_df <- inventory_parts %>%\n  left_join(colors_df) %>%\n  left_join(inventories, by = c(\"inventory_id\" = \"id\")) %>%\n  left_join(sets %>% \n              rename(set_name = name) %>%\n              select(set_num,set_name,year,theme_id,num_parts) ,by = \"set_num\") %>%\n  left_join(themes)\n```\n:::\n\n\n\n\n## Research Question\n\nDevelop a research question that you are interested in. *You may need to play with the data a little bit to learn more about what the values mean before you decide on a question.*\n\n> Color Distribution of Parts within Themes and Across Time\n\n\n\n## Data Visualization\n\nCreate a visualization that answers or addresses your research question.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ntop_themes <- all_df %>% \n  distinct(set_num,theme_name) %>%\n  count(theme_name) %>%\n  arrange(desc(n)) %>%\n  slice(2:11) %>% pull(theme_name) \n\nbasic_name = colors_df %>% pull(\"color_name\") %>% stringr::word(., -1) %>% gsub(\"Trans-|Black-|DBGray|-\", \"\", .) \n\ncolor_pal <- paste0('#',sort(colors_df$rgb))\nnames(color_pal) <- colors_df$color_name[order(colors_df$rgb)]\n\nall_df %>%\n  filter(theme_name %in% top_themes) %>%\n  mutate(color_name = factor(color_name,levels = names(color_pal))) %>%\n  mutate(theme_name = factor(theme_name,levels = top_themes)) %>%\n  group_by(theme_name,color_name) %>%\n  summarize(n = sum(quantity)) %>%\n  ggplot(aes(x = theme_name, y = n/10000, fill = color_name)) +\n  geom_bar(stat='identity',color='darkgrey',size=0.1) +\n  scale_fill_manual(values=color_pal,guide='none') +\n  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  labs(x = '',y ='Number of Parts (10k)',title='Color Distribution of Lego Parts within Top 10 Themes with the Most Sets')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nall_df %>%\n  filter(theme_name %in% top_themes) %>%\n  mutate(color_name = factor(color_name,levels = names(color_pal))) %>%\n  mutate(theme_name = factor(theme_name,levels = top_themes)) %>%\n  group_by(theme_name,color_name) %>%\n  summarize(n = sum(quantity)) %>%\n  ggplot(aes(x = theme_name, y = n, fill = color_name)) +\n  geom_bar(stat='identity',position='fill',color='darkgrey',size=0.1) +\n  scale_fill_manual(values=color_pal,guide='none') +\n  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  labs(x = '',y ='Proportion of Parts',title='Color Distribution of Lego Parts within Top 10 Themes with the Most Sets')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n\n```{.r .cell-code}\nall_df %>%\n  #filter(theme_name %in% top_themes) %>%\n  mutate(color_name = factor(color_name,levels = names(color_pal))) %>%\n  mutate(theme_name = factor(theme_name,levels = top_themes)) %>%\n  group_by(color_name,year) %>%\n  summarize(n = sum(quantity)) %>%\n  ggplot(aes(x = year, y = n/10000, fill = color_name)) +\n  geom_bar(stat='identity', color='darkgrey', size=0.1) +\n  scale_fill_manual(values=color_pal, guide='none') +\n  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  labs(x = '',y =\"Number of Parts (10K's)\",title='Color Distribution of Lego Parts in Sets over Time')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-3.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#color_groups<-read_csv('ColorGroups.csv') %>% rename()\n\n\ncolors_df <- colors_df %>% mutate(HEX = paste0('#',rgb)) \ncolors_df <- colors_df %>% pull(HEX) %>% col2rgb() %>% t() %>% bind_cols(colors_df) \n\nset.seed(123)\ncolors_df %>% select(red,blue,green) %>% kmeans(centers=5) -> clust\n\n\n\ncolors_df <- colors_df %>% mutate(color_label= clust$cluster)\n\ncolor_pal <-colors_df$HEX\nnames(color_pal) <- colors_df$HEX\ncolors_df %>% ggplot(aes(x = red,y = blue,color=HEX)) + geom_point() +facet_wrap(~color_label)+ guides(color = 'none') + theme_classic() + scale_color_manual(values=color_pal)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\ncolor_pal <- colors_df %>% arrange(color_label,red) %>% pull(HEX)\nnames(color_pal) <- colors_df %>% arrange(color_label,red) %>% pull(color_name)\n\n\nall_df %>%\n  filter(theme_name %in% top_themes) %>%\n  mutate(theme_group = case_when(\n    theme_name %in% c('Basic Set','Town','Supplemental','Classic Town') ~ 'Lego Basics',\n    theme_name %in% c('Gear','Technic') ~ 'Mechanical',\n    theme_name %in% c('Star Wars','Bionicle','Ninjago') ~ 'Action',\n    theme_name %in% c('Friends') ~ 'Girl Branded'\n  )) %>%\n  mutate(color_name = factor(color_name,levels = names(color_pal))) %>%\n  mutate(theme_name = factor(theme_name,levels = top_themes)) %>%\n  group_by(theme_name,color_name,theme_group) %>%\n  summarize(n = sum(quantity)) %>%\n  ggplot(aes(x = theme_name, y = n, fill = color_name)) +\n  geom_bar(stat='identity',position='fill',color='darkgrey',size=0.1) +\n  facet_grid(~theme_group, scales=\"free\") +\n  scale_fill_manual(values=color_pal,guide='none') +\n  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  labs(x = '',y ='Proportion of Parts',title='Color Distribution of Lego Parts within Top 10 Themes with the Most Sets')\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}