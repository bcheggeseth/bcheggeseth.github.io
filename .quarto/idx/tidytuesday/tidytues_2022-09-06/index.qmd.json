{"title":"LEGO Sets","markdown":{"yaml":{"title":"LEGO Sets","date":"2022-09-06","image":"tt20220906.jpeg","about":{"template":"solana","image":"tt20220906.jpeg"}},"headingText":"Get the Data","containsRefs":false,"markdown":"\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE, error = TRUE,warning=FALSE,message=FALSE)\nlibrary(tidyverse)\nlibrary(ggplot2)\n```\n\n```{r data_setup}\nlibrary(readr) #install.packages('readr') in Console first\nlibrary(dplyr) #install.packages('dplyr') in Console first\n\ninventories <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-06/inventories.csv.gz')\ninventory_sets <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-06/inventory_sets.csv.gz')\nsets <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-06/sets.csv.gz')\n\n\n```\n\n## Data Context\n\n### LEGO sets\n\nThe data this week comes from rebrickable courtesy of Georgios Karamanis.\n\nThe LEGO Parts/Sets/Colors and Inventories of every official LEGO set in the Rebrickable database is available for download as csv files here. These files are automatically updated daily. If you need more details, you can use the API which provides real-time data, but has rate limits that prevent bulk downloading of data.\n\nIf you'd like to get more data, go to https://rebrickable.com/downloads/ and download any X.csv.gz files.\n\n```{r eval=TRUE}\n# I downloaded themes, colors and inventory_parts from the site above.\nthemes <- readr::read_csv('themes.csv.gz') %>% rename(theme_name = name,theme_id = id)\ncolors_df <- readr::read_csv('colors.csv.gz') %>% rename(color_name = name, color_id = id)\ninventory_parts <- readr::read_csv('inventory_parts.csv.gz') \n\n\nall_df <- inventory_parts %>%\n  left_join(colors_df) %>%\n  left_join(inventories, by = c(\"inventory_id\" = \"id\")) %>%\n  left_join(sets %>% \n              rename(set_name = name) %>%\n              select(set_num,set_name,year,theme_id,num_parts) ,by = \"set_num\") %>%\n  left_join(themes)\n\n```\n\n## Research Question\n\nDevelop a research question that you are interested in. *You may need to play with the data a little bit to learn more about what the values mean before you decide on a question.*\n\n> Color Distribution of Parts within Themes and Across Time\n\n\n\n## Data Visualization\n\nCreate a visualization that answers or addresses your research question.\n\n```{r}\nlibrary(ggplot2)\ntop_themes <- all_df %>% \n  distinct(set_num,theme_name) %>%\n  count(theme_name) %>%\n  arrange(desc(n)) %>%\n  slice(2:11) %>% pull(theme_name) \n\nbasic_name = colors_df %>% pull(\"color_name\") %>% stringr::word(., -1) %>% gsub(\"Trans-|Black-|DBGray|-\", \"\", .) \n\ncolor_pal <- paste0('#',sort(colors_df$rgb))\nnames(color_pal) <- colors_df$color_name[order(colors_df$rgb)]\n\nall_df %>%\n  filter(theme_name %in% top_themes) %>%\n  mutate(color_name = factor(color_name,levels = names(color_pal))) %>%\n  mutate(theme_name = factor(theme_name,levels = top_themes)) %>%\n  group_by(theme_name,color_name) %>%\n  summarize(n = sum(quantity)) %>%\n  ggplot(aes(x = theme_name, y = n/10000, fill = color_name)) +\n  geom_bar(stat='identity',color='darkgrey',size=0.1) +\n  scale_fill_manual(values=color_pal,guide='none') +\n  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  labs(x = '',y ='Number of Parts (10k)',title='Color Distribution of Lego Parts within Top 10 Themes with the Most Sets')\n\n\nall_df %>%\n  filter(theme_name %in% top_themes) %>%\n  mutate(color_name = factor(color_name,levels = names(color_pal))) %>%\n  mutate(theme_name = factor(theme_name,levels = top_themes)) %>%\n  group_by(theme_name,color_name) %>%\n  summarize(n = sum(quantity)) %>%\n  ggplot(aes(x = theme_name, y = n, fill = color_name)) +\n  geom_bar(stat='identity',position='fill',color='darkgrey',size=0.1) +\n  scale_fill_manual(values=color_pal,guide='none') +\n  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  labs(x = '',y ='Proportion of Parts',title='Color Distribution of Lego Parts within Top 10 Themes with the Most Sets')\n\n\n\nall_df %>%\n  #filter(theme_name %in% top_themes) %>%\n  mutate(color_name = factor(color_name,levels = names(color_pal))) %>%\n  mutate(theme_name = factor(theme_name,levels = top_themes)) %>%\n  group_by(color_name,year) %>%\n  summarize(n = sum(quantity)) %>%\n  ggplot(aes(x = year, y = n/10000, fill = color_name)) +\n  geom_bar(stat='identity', color='darkgrey', size=0.1) +\n  scale_fill_manual(values=color_pal, guide='none') +\n  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  labs(x = '',y =\"Number of Parts (10K's)\",title='Color Distribution of Lego Parts in Sets over Time')\n```\n```{r}\n#color_groups<-read_csv('ColorGroups.csv') %>% rename()\n\n\ncolors_df <- colors_df %>% mutate(HEX = paste0('#',rgb)) \ncolors_df <- colors_df %>% pull(HEX) %>% col2rgb() %>% t() %>% bind_cols(colors_df) \n\nset.seed(123)\ncolors_df %>% select(red,blue,green) %>% kmeans(centers=5) -> clust\n\n\n\ncolors_df <- colors_df %>% mutate(color_label= clust$cluster)\n\ncolor_pal <-colors_df$HEX\nnames(color_pal) <- colors_df$HEX\ncolors_df %>% ggplot(aes(x = red,y = blue,color=HEX)) + geom_point() +facet_wrap(~color_label)+ guides(color = 'none') + theme_classic() + scale_color_manual(values=color_pal)\n\ncolor_pal <- colors_df %>% arrange(color_label,red) %>% pull(HEX)\nnames(color_pal) <- colors_df %>% arrange(color_label,red) %>% pull(color_name)\n\n\nall_df %>%\n  filter(theme_name %in% top_themes) %>%\n  mutate(theme_group = case_when(\n    theme_name %in% c('Basic Set','Town','Supplemental','Classic Town') ~ 'Lego Basics',\n    theme_name %in% c('Gear','Technic') ~ 'Mechanical',\n    theme_name %in% c('Star Wars','Bionicle','Ninjago') ~ 'Action',\n    theme_name %in% c('Friends') ~ 'Girl Branded'\n  )) %>%\n  mutate(color_name = factor(color_name,levels = names(color_pal))) %>%\n  mutate(theme_name = factor(theme_name,levels = top_themes)) %>%\n  group_by(theme_name,color_name,theme_group) %>%\n  summarize(n = sum(quantity)) %>%\n  ggplot(aes(x = theme_name, y = n, fill = color_name)) +\n  geom_bar(stat='identity',position='fill',color='darkgrey',size=0.1) +\n  facet_grid(~theme_group, scales=\"free\") +\n  scale_fill_manual(values=color_pal,guide='none') +\n  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  labs(x = '',y ='Proportion of Parts',title='Color Distribution of Lego Parts within Top 10 Themes with the Most Sets')\n\n\n```","srcMarkdownNoYaml":"\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE, error = TRUE,warning=FALSE,message=FALSE)\nlibrary(tidyverse)\nlibrary(ggplot2)\n```\n\n```{r data_setup}\n# Get the Data\nlibrary(readr) #install.packages('readr') in Console first\nlibrary(dplyr) #install.packages('dplyr') in Console first\n\ninventories <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-06/inventories.csv.gz')\ninventory_sets <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-06/inventory_sets.csv.gz')\nsets <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2022/2022-09-06/sets.csv.gz')\n\n\n```\n\n## Data Context\n\n### LEGO sets\n\nThe data this week comes from rebrickable courtesy of Georgios Karamanis.\n\nThe LEGO Parts/Sets/Colors and Inventories of every official LEGO set in the Rebrickable database is available for download as csv files here. These files are automatically updated daily. If you need more details, you can use the API which provides real-time data, but has rate limits that prevent bulk downloading of data.\n\nIf you'd like to get more data, go to https://rebrickable.com/downloads/ and download any X.csv.gz files.\n\n```{r eval=TRUE}\n# I downloaded themes, colors and inventory_parts from the site above.\nthemes <- readr::read_csv('themes.csv.gz') %>% rename(theme_name = name,theme_id = id)\ncolors_df <- readr::read_csv('colors.csv.gz') %>% rename(color_name = name, color_id = id)\ninventory_parts <- readr::read_csv('inventory_parts.csv.gz') \n\n\nall_df <- inventory_parts %>%\n  left_join(colors_df) %>%\n  left_join(inventories, by = c(\"inventory_id\" = \"id\")) %>%\n  left_join(sets %>% \n              rename(set_name = name) %>%\n              select(set_num,set_name,year,theme_id,num_parts) ,by = \"set_num\") %>%\n  left_join(themes)\n\n```\n\n## Research Question\n\nDevelop a research question that you are interested in. *You may need to play with the data a little bit to learn more about what the values mean before you decide on a question.*\n\n> Color Distribution of Parts within Themes and Across Time\n\n\n\n## Data Visualization\n\nCreate a visualization that answers or addresses your research question.\n\n```{r}\nlibrary(ggplot2)\ntop_themes <- all_df %>% \n  distinct(set_num,theme_name) %>%\n  count(theme_name) %>%\n  arrange(desc(n)) %>%\n  slice(2:11) %>% pull(theme_name) \n\nbasic_name = colors_df %>% pull(\"color_name\") %>% stringr::word(., -1) %>% gsub(\"Trans-|Black-|DBGray|-\", \"\", .) \n\ncolor_pal <- paste0('#',sort(colors_df$rgb))\nnames(color_pal) <- colors_df$color_name[order(colors_df$rgb)]\n\nall_df %>%\n  filter(theme_name %in% top_themes) %>%\n  mutate(color_name = factor(color_name,levels = names(color_pal))) %>%\n  mutate(theme_name = factor(theme_name,levels = top_themes)) %>%\n  group_by(theme_name,color_name) %>%\n  summarize(n = sum(quantity)) %>%\n  ggplot(aes(x = theme_name, y = n/10000, fill = color_name)) +\n  geom_bar(stat='identity',color='darkgrey',size=0.1) +\n  scale_fill_manual(values=color_pal,guide='none') +\n  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  labs(x = '',y ='Number of Parts (10k)',title='Color Distribution of Lego Parts within Top 10 Themes with the Most Sets')\n\n\nall_df %>%\n  filter(theme_name %in% top_themes) %>%\n  mutate(color_name = factor(color_name,levels = names(color_pal))) %>%\n  mutate(theme_name = factor(theme_name,levels = top_themes)) %>%\n  group_by(theme_name,color_name) %>%\n  summarize(n = sum(quantity)) %>%\n  ggplot(aes(x = theme_name, y = n, fill = color_name)) +\n  geom_bar(stat='identity',position='fill',color='darkgrey',size=0.1) +\n  scale_fill_manual(values=color_pal,guide='none') +\n  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  labs(x = '',y ='Proportion of Parts',title='Color Distribution of Lego Parts within Top 10 Themes with the Most Sets')\n\n\n\nall_df %>%\n  #filter(theme_name %in% top_themes) %>%\n  mutate(color_name = factor(color_name,levels = names(color_pal))) %>%\n  mutate(theme_name = factor(theme_name,levels = top_themes)) %>%\n  group_by(color_name,year) %>%\n  summarize(n = sum(quantity)) %>%\n  ggplot(aes(x = year, y = n/10000, fill = color_name)) +\n  geom_bar(stat='identity', color='darkgrey', size=0.1) +\n  scale_fill_manual(values=color_pal, guide='none') +\n  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  labs(x = '',y =\"Number of Parts (10K's)\",title='Color Distribution of Lego Parts in Sets over Time')\n```\n```{r}\n#color_groups<-read_csv('ColorGroups.csv') %>% rename()\n\n\ncolors_df <- colors_df %>% mutate(HEX = paste0('#',rgb)) \ncolors_df <- colors_df %>% pull(HEX) %>% col2rgb() %>% t() %>% bind_cols(colors_df) \n\nset.seed(123)\ncolors_df %>% select(red,blue,green) %>% kmeans(centers=5) -> clust\n\n\n\ncolors_df <- colors_df %>% mutate(color_label= clust$cluster)\n\ncolor_pal <-colors_df$HEX\nnames(color_pal) <- colors_df$HEX\ncolors_df %>% ggplot(aes(x = red,y = blue,color=HEX)) + geom_point() +facet_wrap(~color_label)+ guides(color = 'none') + theme_classic() + scale_color_manual(values=color_pal)\n\ncolor_pal <- colors_df %>% arrange(color_label,red) %>% pull(HEX)\nnames(color_pal) <- colors_df %>% arrange(color_label,red) %>% pull(color_name)\n\n\nall_df %>%\n  filter(theme_name %in% top_themes) %>%\n  mutate(theme_group = case_when(\n    theme_name %in% c('Basic Set','Town','Supplemental','Classic Town') ~ 'Lego Basics',\n    theme_name %in% c('Gear','Technic') ~ 'Mechanical',\n    theme_name %in% c('Star Wars','Bionicle','Ninjago') ~ 'Action',\n    theme_name %in% c('Friends') ~ 'Girl Branded'\n  )) %>%\n  mutate(color_name = factor(color_name,levels = names(color_pal))) %>%\n  mutate(theme_name = factor(theme_name,levels = top_themes)) %>%\n  group_by(theme_name,color_name,theme_group) %>%\n  summarize(n = sum(quantity)) %>%\n  ggplot(aes(x = theme_name, y = n, fill = color_name)) +\n  geom_bar(stat='identity',position='fill',color='darkgrey',size=0.1) +\n  facet_grid(~theme_group, scales=\"free\") +\n  scale_fill_manual(values=color_pal,guide='none') +\n  theme_classic() + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +\n  labs(x = '',y ='Proportion of Parts',title='Color Distribution of Lego Parts within Top 10 Themes with the Most Sets')\n\n\n```"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"index.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.6.40","editor":"visual","theme":["yeti","../../theme.scss"],"title":"LEGO Sets","date":"2022-09-06","image":"tt20220906.jpeg","about":{"template":"solana","image":"tt20220906.jpeg"}},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}